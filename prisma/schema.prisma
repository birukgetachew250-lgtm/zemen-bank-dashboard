
datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

model Branch {
  id          String       @id @default(uuid())
  name        String       @unique
  location    String
  createdAt   DateTime     @default(now())
  departments Department[]
}

model Department {
  id        String   @id @default(uuid())
  name      String
  branch    Branch   @relation(fields: [branchId], references: [id], onDelete: Cascade)
  branchId  String
  createdAt DateTime @default(now())

  @@unique([name, branchId])
}

model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String // In a real app, this would be a hash
  role       String
  branch     String?
  department String
  createdAt  DateTime @default(now())
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model MiniApp {
  id             String @id @default(uuid())
  name           String @unique
  url            String
  logo_url       String
  username       String
  password       String
  encryption_key String
}

model Corporate {
  id                      String @id
  name                    String
  industry                String
  status                  String
  internet_banking_status String
  logo_url                String
}

// Models from the old system.prisma, now merged
model Customer {
  id               Int                @id @default(autoincrement())
  name             String
  phone            String             @unique
  status           String
  registeredAt     DateTime           @default(now())
  pendingApprovals PendingApproval[]
  transactions     Transaction[]
}

model PendingApproval {
  id            Int      @id @default(autoincrement())
  customerId    Int
  customer      Customer @relation(fields: [customerId], references: [id])
  type          String
  requestedAt   DateTime @default(now())
  status        String   @default("pending")
  customerName  String
  customerPhone String
  details       String?
}

model Transaction {
  id             String   @id @default(uuid())
  customerId     Int
  customer       Customer @relation(fields: [customerId], references: [id])
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime @default(now())
  type           String
  channel        String
  to_account     String
  is_anomalous   Boolean  @default(false)
  anomaly_reason String?
}

model AppUser {
  Id               String    @id
  CIFNumber        String    @unique
  FirstName        String?
  SecondName       String?
  LastName         String?
  Email            String?
  PhoneNumber      String?   @unique
  Status           String?
  SignUpMainAuth   String?
  SignUp2FA        String?
  Channel          String?
  InsertDate       DateTime  @default(now())
  UpdateDate       DateTime  @updatedAt
  AddressLine1     String?
  AddressLine2     String?
  AddressLine3     String?
  AddressLine4     String?
  Nationality      String?
  BranchCode       String?
  BranchName       String?
}

model Account {
  Id            String   @id
  CIFNumber     String
  AccountNumber String
  FirstName     String?
  SecondName    String?
  LastName      String?
  AccountType   String?
  Currency      String?
  Status        String?
  BranchName    String?
  InsertDate    DateTime @default(now())
  UpdateDate    DateTime @updatedAt
  
  @@index([CIFNumber])
}

model SecurityQuestion {
  Id          Int      @id @default(autoincrement())
  question    String
  UserSecurity UserSecurity[]
}

model UserSecurity {
  Id                 String  @id @default(uuid())
  UserId             String  @unique
  CIFNumber          String  @unique
  PinHash            String?
  Status             String?
  SecurityQuestionId Int?
  SecurityQuestion   SecurityQuestion? @relation(fields: [SecurityQuestionId], references: [Id])
  SecurityAnswer     String?
}

model OtpCode {
  Id         Int      @id @default(autoincrement())
  UserId     String
  Purpose    String
  OtpType    String   @default("numeric")
  Code       String
  IsUsed     Boolean  @default(false)
  ExpiresAt  DateTime
  Attempts   Int      @default(0)
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
}
