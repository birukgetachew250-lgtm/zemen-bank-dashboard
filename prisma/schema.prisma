// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String // In a real app, this would be a hash
  role       String
  department String
  branch     String?
  createdAt  DateTime @default(now())
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model Branch {
  id        String       @id
  name      String       @unique
  location  String
  createdAt DateTime     @default(now())
  departments Department[]
}

model Department {
  id        String   @id
  name      String   @unique
  branchId  String
  branch    Branch   @relation(fields: [branchId], references: [id])
  createdAt DateTime @default(now())
}

model Customer {
  id           String            @id @default(cuid())
  name         String
  phone        String            @unique
  status       String // e.g., 'Registered', 'Active', 'Inactive', 'Dormant'
  registeredAt DateTime          @default(now())
  transactions Transaction[]
  approvals    PendingApproval[]
}

model Transaction {
  id          String    @id @default(cuid())
  customerId  String
  customer    Customer  @relation(fields: [customerId], references: [id])
  amount      Float
  fee         Float
  status      String // 'Successful', 'Failed', 'Pending', 'Reversed'
  timestamp   DateTime  @default(now())
  type        String // 'P2P', 'Bill Payment', etc.
  channel     String // 'App', 'USSD', etc.
  from_account String?
  to_account  String?
  is_anomalous Boolean  @default(false)
  anomaly_reason String?
}

model PendingApproval {
  id            String   @id @default(cuid())
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  type          String // 'unblock', 'pin-reset', etc.
  status        String   @default("pending")
  requestedAt   DateTime @default(now())
  customerName  String
  customerPhone String
  details       String?
}

// Separate models for the legacy system data structure
// These are not meant to be relational to the above in Prisma,
// as they would be in a separate microservice/database in a real system.

model AppUser {
  Id                 String       @id
  CIFNumber          String       @unique
  FirstName          String?
  SecondName         String?
  LastName           String?
  Email              String?
  PhoneNumber        String?
  Status             String?
  SignUpMainAuth     String?
  SignUp2FA          String?
  BranchCode         String?
  BranchName         String?
  AddressLine1       String?
  AddressLine2       String?
  AddressLine3       String?
  AddressLine4       String?
  Nationality        String?
  InsertDate         DateTime     @default(now())
  UpdateDate         DateTime     @updatedAt
  Channel            String?
}

model Account {
  Id            String  @id
  CIFNumber     String
  AccountNumber String  @unique
  FirstName     String?
  SecondName    String?
  LastName      String?
  AccountType   String?
  Currency      String?
  Status        String?
  BranchName    String?
}

model UserSecurity {
  UserId                  String  @id
  CIFNumber               String  @unique
  Status                  String?
  PinHash                 String?
  SecurityQuestionId      Int?
  SecurityAnswer          String?
  SecurityQuestionId2     Int?
  SecurityAnswer2         String?
  SecurityQuestionId3     Int?
  SecurityAnswer3         String?
  SecurityQuestionId4     Int?
  SecurityAnswer4         String?
}

model SecurityQuestion {
  Id       Int    @id @default(autoincrement())
  Question String
}

model OtpCode {
  Id         Int      @id @default(autoincrement())
  UserId     String
  Purpose    String
  OtpCode    String
  OtpType    String // SMS, Email, etc.
  IsUsed     Boolean  @default(false)
  Attempts   Int      @default(0)
  ExpiresAt  DateTime
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
}

model Corporate {
  id                      String @id @default(cuid())
  name                    String
  industry                String
  status                  String // e.g., 'Active', 'Inactive', 'Pending'
  internet_banking_status String // e.g., 'Active', 'Disabled', 'Pending'
  logo_url                String?
}

model MiniApp {
  id             String  @id @default(cuid())
  name           String
  url            String
  logo_url       String?
  username       String
  password       String
  encryption_key String
}
