// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// USER MANAGEMENT MODELS

model User {
  id          Int      @id @default(autoincrement())
  employeeId  String   @unique
  name        String
  email       String   @unique
  password    String
  role        String
  branch      String?
  department  String
  createdAt   DateTime @default(now())
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
}

model Branch {
  id         String       @id
  name       String       @unique
  location   String
  departments Department[]
  createdAt  DateTime     @default(now())
}

model Department {
  id        String   @id
  name      String   @unique
  branch    Branch   @relation(fields: [branchId], references: [id])
  branchId  String
  createdAt DateTime @default(now())
}


// CUSTOMER AND TRANSACTION MODELS (Previously in system.prisma)

model AppUser {
  Id                   String         @id
  CIFNumber            String         @unique
  FirstName            String
  SecondName           String?
  LastName             String
  Email                String
  PhoneNumber          String
  Status               String
  SignUpMainAuth       String
  SignUp2FA            String
  Channel              String?
  BranchCode           String?
  BranchName           String
  AddressLine1         String?
  AddressLine2         String?
  AddressLine3         String?
  AddressLine4         String?
  Nationality          String?
  InsertDate           DateTime       @default(now())
  UpdateDate           DateTime       @updatedAt
  userSecurity         UserSecurity?
}

model Account {
  Id            String    @id
  CIFNumber     String
  AccountNumber String    @unique
  FirstName     String
  SecondName    String?
  LastName      String
  AccountType   String
  Currency      String
  Status        String
  BranchName    String
  InsertDate    DateTime  @default(now())
  UpdateDate    DateTime  @updatedAt
}


model UserSecurity {
  UserId             String            @id
  User               AppUser           @relation(fields: [UserId], references: [Id])
  CIFNumber          String            @unique
  Status             String
  PinHash            String?
  PasswordHash       String?
  SecurityQuestion   SecurityQuestion? @relation(fields: [SecurityQuestionId], references: [Id])
  SecurityQuestionId Int?
  SecurityAnswer     String?
  InsertDate         DateTime          @default(now())
  UpdateDate         DateTime          @updatedAt
}

model OtpCode {
  Id         Int      @id @default(autoincrement())
  UserId     String
  Purpose    String
  OtpCode    String
  OtpType    String
  IsUsed     Boolean  @default(false)
  Attempts   Int      @default(0)
  ExpiresAt  DateTime
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
}

model SecurityQuestion {
  Id          Int            @id @default(autoincrement())
  question    String
  UserSecurity UserSecurity[]
}

model Corporate {
  id                      String   @id
  name                    String
  industry                String
  status                  String
  internet_banking_status String
  logo_url                String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model MiniApp {
  id             String  @id @default(uuid())
  name           String
  url            String
  logo_url       String?
  username       String
  password       String
  encryption_key String
}

model Customer {
  id            Int               @id @default(autoincrement())
  name          String
  phone         String            @unique
  status        String
  registeredAt  DateTime          @default(now())
  transactions  Transaction[]
  pendingApprovals PendingApproval[]
}

model Transaction {
  id             String    @id @default(cuid())
  customerId     Int
  customer       Customer  @relation(fields: [customerId], references: [id])
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime  @default(now())
  type           String
  channel        String
  to_account     String
  is_anomalous   Boolean   @default(false)
  anomaly_reason String?
}

model PendingApproval {
  id            String    @id @default(cuid())
  customerId    Int
  customer      Customer  @relation(fields: [customerId], references: [id])
  type          String
  status        String    @default("pending")
  requestedAt   DateTime  @default(now())
  resolvedAt    DateTime?
  customerName  String
  customerPhone String
  details       String?
}
