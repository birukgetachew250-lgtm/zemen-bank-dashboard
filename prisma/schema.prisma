datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

generator client {
  provider = "prisma-client-js"
}

// User Management Module

model User {
  id         Int    @id @default(autoincrement())
  employeeId String @unique
  name       String
  email      String @unique
  password   String // In a real app, this should be a hashed password
  role       String
  branch     String?
  department String
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model Branch {
  id         String       @id @default(uuid())
  name       String       @unique
  location   String
  createdAt  DateTime     @default(now())
  Department Department[]
}

model Department {
  id        String @id @default(uuid())
  name      String
  branch    Branch @relation(fields: [branchId], references: [id])
  branchId  String
  createdAt DateTime @default(now())
}

model MiniApp {
  id             String @id @default(uuid())
  name           String
  url            String
  logo_url       String?
  username       String
  password       String
  encryption_key String
}

// System Module Tables

model AppUser {
  Id               String   @id
  CIFNumber        String   @unique
  FirstName        String?
  SecondName       String?
  LastName         String?
  Email            String?
  PhoneNumber      String?  @unique
  Status           String?
  LastLoginDate    DateTime @default(now())
  SignUpMainAuth   String?
  SignUp2FA        String?
  AddressLine1     String?
  AddressLine2     String?
  AddressLine3     String?
  AddressLine4     String?
  Nationality      String?
  BranchCode       String?
  BranchName       String?
  Channel          String?
  InsertDate       DateTime @default(now())
  UpdateDate       DateTime @updatedAt
  UserSecurity     UserSecurity?
}

model Account {
  Id            String   @id
  CIFNumber     String
  AccountNumber String   @unique
  FirstName     String?
  SecondName    String?
  LastName      String?
  AccountType   String?
  Currency      String?
  Status        String?
  BranchCode    String?
  BranchName    String?
  InsertDate    DateTime @default(now())
  UpdateDate    DateTime @updatedAt
}

model UserSecurity {
  UserId             String   @id
  user               AppUser  @relation(fields: [UserId], references: [Id])
  CIFNumber          String   @unique
  PinHash            String?
  PasswordHash       String?
  Status             String?
  SecurityQuestionId Int?
  SecurityAnswer     String?
  InsertDate         DateTime @default(now())
  UpdateDate         DateTime @updatedAt
}

model SecurityQuestion {
  id       Int    @id @default(autoincrement())
  question String
}

model OtpCode {
  Id         String   @id
  UserId     String
  Purpose    String
  OtpType    String
  Code       String
  IsUsed     Boolean
  Attempts   Int
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
  ExpiresAt  DateTime
}

model Transaction {
  id             String  @id @default(uuid())
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])
  timestamp      DateTime
  type           String
  amount         Float
  fee            Float
  status         String
  channel        String
  to_account     String
  is_anomalous   Boolean?
  anomaly_reason String?
}

model PendingApproval {
  id            String   @id @default(uuid())
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  type          String
  status        String   @default("pending")
  requestedAt   DateTime @default(now())
  customerName  String
  customerPhone String
  details       String?
}

model Customer {
  id              String            @id @default(uuid())
  name            String
  phone           String            @unique
  status          String
  registeredAt    DateTime          @default(now())
  transactions    Transaction[]
  pendingApprovals PendingApproval[]
}

model Corporate {
  id                      String @id
  name                    String
  industry                String
  status                  String
  internet_banking_status String
  logo_url                String?
}
