datasource db {
  provider = "postgresql"
  url      = env("DASH_MODULE_PROD_DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

// Separate client for system-level data, if needed
generator system {
  provider = "prisma-client-js"
  output   = "./system-client"
}

model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String // In a real app, this would be a hash
  role       String
  branch     String?
  department String
  mfaEnabled Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model Branch {
  id          String       @id @unique
  name        String       @unique
  location    String
  createdAt   DateTime     @default(now())
  departments Department[]
}

model Department {
  id        String   @id @unique
  name      String   @unique
  branch    Branch   @relation(fields: [branchId], references: [id])
  branchId  String
  createdAt DateTime @default(now())
}

model Customer {
  id           Int               @id @default(autoincrement())
  name         String
  phone        String            @unique
  status       String
  registeredAt DateTime          @default(now())
  transactions Transaction[]
  approvals    PendingApproval[]
}

model PendingApproval {
  id            Int      @id @default(autoincrement())
  customerId    Int
  customer      Customer @relation(fields: [customerId], references: [id])
  type          String // e.g. new-customer, pin-reset, suspend
  requestedAt   DateTime @default(now())
  customerName  String
  customerPhone String
  details       String?
  status        String   @default("pending") // pending, approved, rejected
}

model Transaction {
  id             String   @id @default(cuid())
  customerId     Int
  customer       Customer @relation(fields: [customerId], references: [id])
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime @default(now())
  type           String
  channel        String
  from_account   String?
  to_account     String?
  is_anomalous   Boolean  @default(false)
  anomaly_reason String?
}

model Corporate {
  id                      String @id @unique
  name                    String
  industry                String
  status                  String
  internet_banking_status String
  logo_url                String
}

model MiniApp {
  id             String @id @default(cuid())
  name           String
  url            String
  logo_url       String
  username       String
  password       String
  encryption_key String
}

model SystemActivityLog {
  id        Int      @id @default(autoincrement())
  timestamp DateTime @default(now())
  userEmail String
  action    String
  status    String
  details   String?
  ipAddress String?
}

model IpWhitelist {
  id        Int      @id @default(autoincrement())
  cidr      String   @unique
  label     String
  createdAt DateTime @default(now())
}

model SecurityPolicy {
  id                  Int      @id @default(1)
  mfaRequired         Boolean  @default(true)
  allowedMfaMethods   String[] @default(["email"])
  sessionTimeout      Int      @default(30) // in minutes
  concurrentSessions  Int      @default(1) // 0 for unlimited
}

model Integration {
  id            Int    @id @default(autoincrement())
  name          String @unique
  type          String // 'WSO2', 'Flexcube', 'SMS'
  baseUrl       String
  username      String?
  password      String? // Encrypted
  status        String @default("Disconnected")
  isProduction  Boolean @default(false)
}

// The models below are managed in separate Oracle databases
// and are removed from this schema to avoid conflicts.
// AppUser, Account, SecurityQuestion, UserSecurity, OtpCode