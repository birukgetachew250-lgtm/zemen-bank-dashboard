// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

// USER MANAGEMENT MODELS
model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String // In a real app, this should be hashed
  role       String
  branch     String?
  department String
  createdAt  DateTime @default(now())
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model Branch {
  id         String       @id
  name       String       @unique
  location   String
  createdAt  DateTime     @default(now())
  Department Department[]
}

model Department {
  id        String   @id
  name      String
  branchId  String
  createdAt DateTime @default(now())
  branch    Branch   @relation(fields: [branchId], references: [id])
}

// BANKING SUPER APP MODELS
model AppUser {
  Id                 String    @id
  CIFNumber          String    @unique
  FirstName          String?
  SecondName         String?
  LastName           String?
  Email              String?
  PhoneNumber        String?
  Status             String // e.g., Active, Registered, Inactive, Block
  SignUpMainAuth     String? // e.g., PIN, PASSWORD, FINGERPRINT
  SignUp2FA          String? // e.g., SMSOTP, GAUTH, SQ, EMAILOTP, None
  Channel            String? // e.g., Mobile App, USSD, Both
  BranchCode         String?
  BranchName         String?
  AddressLine1       String?
  AddressLine2       String?
  AddressLine3       String?
  AddressLine4       String?
  Nationality        String?
  LastLoginDate      DateTime?
  LastActivityDate   DateTime?
  UpdateDate         DateTime  @default(now())
  InsertDate         DateTime  @default(now())
  UserSecurity       UserSecurity?
}

model Account {
  Id            String  @id
  CIFNumber     String
  AccountNumber String
  FirstName     String?
  SecondName    String?
  LastName      String?
  AccountType   String?
  Currency      String?
  Status        String
  BranchCode    String?
  BranchName    String?
}

model SecurityQuestion {
  Id       Int      @id @default(autoincrement())
  Question String   @unique
  UserSecurity UserSecurity[]
}

model UserSecurity {
  Id                 String  @id @default(uuid())
  UserId             String  @unique
  CIFNumber          String  @unique
  Status             String
  PinHash            String?
  PasswordHash       String?
  SecurityQuestionId Int?
  SecurityAnswer     String?
  User               AppUser @relation(fields: [UserId], references: [Id])
  SecurityQuestion   SecurityQuestion? @relation(fields: [SecurityQuestionId], references: [Id])
}


model OtpCode {
  Id         Int      @id @default(autoincrement())
  UserId     String
  OtpType    String // e.g., SMS, Email
  OtpCode    String
  Purpose    String // e.g., Login, Transaction, PINReset
  IsUsed     Boolean  @default(false)
  Attempts   Int      @default(0)
  ExpiresAt  DateTime
  UpdateDate DateTime @default(now())
  InsertDate DateTime @default(now())
}

model Customer {
  id            String            @id @default(uuid())
  name          String
  phone         String            @unique
  status        String
  registeredAt  DateTime          @default(now())
  transactions  Transaction[]
  pendingApprovals PendingApproval[]
}

model Transaction {
  id             String    @id @default(uuid())
  customerId     String
  customer       Customer  @relation(fields: [customerId], references: [id])
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime
  type           String
  channel        String
  from_account   String?
  to_account     String
  is_anomalous   Boolean   @default(false)
  anomaly_reason String?
}

model PendingApproval {
  id            String   @id @default(uuid())
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  type          String
  status        String   @default("pending")
  requestedAt   DateTime @default(now())
  resolvedAt    DateTime?
  approverId    String?
  customerName  String
  customerPhone String
  details       String?
}

model Corporate {
    id                      String @id
    name                    String
    industry                String
    status                  String
    internet_banking_status String
    logo_url                String
}

model MiniApp {
    id              String @id @default(uuid())
    name            String @unique
    url             String
    logo_url        String
    username        String
    password        String
    encryption_key  String
}
