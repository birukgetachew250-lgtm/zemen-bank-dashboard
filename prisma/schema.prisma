// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

// Banking App Core Models

model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String // In a real app, this should be a securely hashed password
  role       String
  department String
  branch     String?
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
}

model Branch {
  id        String       @id
  name      String       @unique
  location  String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  departments Department[]
}

model Department {
  id        String   @id
  name      String   @unique
  branchId  String
  branch    Branch   @relation(fields: [branchId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MiniApp {
  id             String @id @default(uuid())
  name           String @unique
  url            String
  logo_url       String?
  username       String
  password       String
  encryption_key String
}


// Mobile/Super App Specific Models
// These would typically be in a separate database in a microservice architecture.

model AppUser {
  Id                 String       @id
  CIFNumber          String       @unique
  FirstName          String?
  SecondName         String?
  LastName           String?
  Email              String?
  PhoneNumber        String?
  Status             String?
  SignUpMainAuth     String?
  SignUp2FA          String?
  Nationality        String?
  AddressLine1       String?
  AddressLine2       String?
  AddressLine3       String?
  AddressLine4       String?
  InsertDate         DateTime     @default(now())
  UpdateDate         DateTime     @updatedAt
  BranchCode         String?
  BranchName         String?
  Channel            String?
}

model Account {
  Id                 String       @id
  CIFNumber          String
  AccountNumber      String?      @unique
  FirstName          String?
  SecondName         String?
  LastName           String?
  AccountType        String?
  Currency           String?
  Status             String?
  BranchCode         String?
  BranchName         String?
  InsertDate         DateTime     @default(now())
  UpdateDate         DateTime     @updatedAt
}

model UserSecurity {
    Id                 String       @id @default(uuid())
    UserId             String
    CIFNumber          String       @unique
    PinHash            String?
    Status             String?
    SecurityQuestionId String?
    SecurityAnswer     String?
    InsertDate         DateTime     @default(now())
    UpdateDate         DateTime     @updatedAt
}

model SecurityQuestion {
    Id       String @id @default(uuid())
    Question String
}

model OtpCode {
    Id                 String    @id
    UserId             String
    Otp                String?
    Purpose            String?
    OtpType            String?
    IsUsed             Boolean   @default(false)
    Attempts           Int       @default(0)
    ExpiresAt          DateTime
    InsertDate         DateTime  @default(now())
    UpdateDate         DateTime  @updatedAt
}


// Legacy Models (for demo purposes)
// These represent tables that might exist in a monolithic system

model Customer {
  id             Int      @id @default(autoincrement())
  name           String
  phone          String
  status         String
  registeredAt   DateTime @default(now())
  
  transactions     Transaction[]
  pendingApprovals PendingApproval[]
}

model Transaction {
  id             String    @id @default(uuid())
  customerId     Int
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime
  type           String
  channel        String
  to_account     String
  is_anomalous   Boolean   @default(false)
  anomaly_reason String?

  customer Customer @relation(fields: [customerId], references: [id])
}

model PendingApproval {
  id            Int      @id @default(autoincrement())
  customerId    Int
  type          String
  status        String   @default("pending")
  requestedAt   DateTime @default(now())
  customerName  String
  customerPhone String
  details       String?

  customer Customer @relation(fields: [customerId], references: [id])
}

model Corporate {
    id                      String @id
    name                    String @unique
    industry                String
    status                  String
    internet_banking_status String
    logo_url                String?
}
