
datasource db {
  provider = "sqlite"
  url      = "file:./zemen.db"
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

model Branch {
  id          String       @id @default(uuid())
  name        String       @unique
  location    String
  departments Department[]
  users       User[]
  createdAt   DateTime     @default(now())
}

model Department {
  id        String   @id @default(uuid())
  name      String
  branch    Branch   @relation(fields: [branchId], references: [id])
  branchId  String
  users     User[]
  createdAt DateTime @default(now())

  @@unique([name, branchId])
}

model User {
  id         Int      @id @default(autoincrement())
  employeeId String   @unique
  name       String
  email      String   @unique
  password   String
  role       String
  branch     String?
  department String
  createdAt  DateTime @default(now())
  branchInfo Branch?  @relation(fields: [branch], references: [name])
  deptInfo   Department? @relation(fields: [department, branch], references: [name, branchId])
}

model Role {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String
}

model SecurityQuestion {
  id             Int            @id @default(autoincrement())
  question       String
  userSecurities UserSecurity[]
}

model OtpCode {
  Id         String   @id @default(uuid())
  UserId     String
  OTP        String
  Purpose    String
  OtpType    String
  ExpiresAt  DateTime
  Attempts   Int      @default(0)
  IsUsed     Boolean  @default(false)
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
}

// System-related models
model Transaction {
  id             String    @id @default(uuid())
  customerId     Int
  customer       Customer  @relation(fields: [customerId], references: [id])
  amount         Float
  fee            Float
  status         String
  timestamp      DateTime  @default(now())
  type           String
  channel        String
  to_account     String
  is_anomalous   Boolean   @default(false)
  anomaly_reason String?
}

model Customer {
  id              Int               @id @default(autoincrement())
  name            String
  phone           String            @unique
  status          String
  registeredAt    DateTime          @default(now())
  transactions    Transaction[]
  pendingApprovals PendingApproval[]
}

model PendingApproval {
  id             Int      @id @default(autoincrement())
  customerId     Int
  customer       Customer @relation(fields: [customerId], references: [id])
  type           String
  status         String   @default("pending")
  requestedAt    DateTime @default(now())
  customerName   String
  customerPhone  String
  details        String?
}

model AppUser {
  Id                 String   @id @default(uuid())
  CIFNumber          String   @unique
  FirstName          String?
  SecondName         String?
  LastName           String?
  Email              String?
  PhoneNumber        String?
  Status             String
  SignUpMainAuth     String?
  SignUp2FA          String?
  AddressLine1       String?
  AddressLine2       String?
  AddressLine3       String?
  AddressLine4       String?
  Nationality        String?
  BranchCode         String?
  BranchName         String?
  Channel            String?
  InsertDate         DateTime @default(now())
  UpdateDate         DateTime @updatedAt
}

model Account {
  Id            String  @id @default(uuid())
  CIFNumber     String
  AccountNumber String? @unique
  FirstName     String?
  SecondName    String?
  LastName      String?
  AccountType   String?
  Currency      String?
  Status        String?
  BranchName    String?
}

model UserSecurity {
  UserId             String            @id
  CIFNumber          String            @unique
  Status             String?
  PinHash            String?
  SecurityQuestion   SecurityQuestion? @relation(fields: [SecurityQuestionId], references: [id])
  SecurityQuestionId Int?
  SecurityAnswer     String?
}

model Corporate {
  id                      String @id @default(uuid())
  name                    String
  industry                String
  status                  String
  internet_banking_status String
  logo_url                String?
}

model MiniApp {
  id             String  @id @default(uuid())
  name           String
  url            String
  logo_url       String?
  username       String
  password       String
  encryption_key String
}
