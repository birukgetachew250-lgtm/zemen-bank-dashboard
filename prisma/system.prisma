// prisma/system.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("SYSTEM_MODULE_DB_URL")
}

model Customer {
  id              String             @id @default(cuid())
  name            String
  phone           String             @unique
  status          String
  registeredAt    DateTime           @default(now())
  transactions    Transaction[]
  pendingApprovals PendingApproval[]
}

model Transaction {
  id              String         @id @default(cuid())
  customerId      String
  amount          Float
  fee             Float
  status          String // e.g., 'Successful', 'Failed', 'Pending', 'Reversed'
  timestamp       DateTime       @default(now())
  type            String // e.g., 'P2P', 'Bill Payment', 'Airtime'
  channel         String // e.g., 'App', 'USSD', 'Agent'
  to_account      String
  is_anomalous    Boolean        @default(false)
  anomaly_reason  String?
  customer        Customer       @relation(fields: [customerId], references: [id])
}

model PendingApproval {
  id              String       @id @default(cuid())
  customerId      String
  type            String       // e.g., 'new-customer', 'pin-reset', 'unblock-customer'
  requestedAt     DateTime     @default(now())
  status          String       @default("pending") // 'pending', 'approved', 'rejected'
  details         Json?
  customerName    String?
  customerPhone   String?
  customer        Customer     @relation(fields: [customerId], references: [id])
}

model OtpCode {
  Id String @id @default(uuid())
  UserId String
  Purpose String
  OtpCode String
  OtpType String
  Attempts Int @default(0)
  IsUsed Boolean @default(false)
  ExpiresAt DateTime
  InsertDate DateTime @default(now())
  UpdateDate DateTime @updatedAt
}

model AppUser {
    Id String @id @default(uuid())
    CIFNumber String @unique
    FirstName String
    SecondName String?
    LastName String
    Email String @unique
    PhoneNumber String @unique
    Status String
    SignUpMainAuth String
    SignUp2FA String
    Channel String?
    BranchCode String?
    BranchName String?
    AddressLine1 String?
    AddressLine2 String?
    AddressLine3 String?
    AddressLine4 String?
    Nationality String?
    InsertDate DateTime @default(now())
    UpdateDate DateTime @updatedAt
}

model Account {
    Id String @id @default(uuid())
    CIFNumber String
    AccountNumber String @unique
    FirstName String
    SecondName String?
    LastName String
    AccountType String
    Currency String
    Status String
    BranchCode String?
    BranchName String?
    InsertDate DateTime @default(now())
    UpdateDate DateTime @updatedAt
}

model UserSecurity {
    Id String @id @default(uuid())
    UserId String @unique
    CIFNumber String @unique
    Status String
    PinHash String?
    SecurityQuestionId String?
    SecurityAnswer String?
    InsertDate DateTime @default(now())
    UpdateDate DateTime @updatedAt
}
